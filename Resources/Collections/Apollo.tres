[gd_resource type="Resource" script_class="GodCardCollection" load_steps=34 format=3 uid="uid://b1qqsnldvvxvp"]

[ext_resource type="Script" uid="uid://bx8x0dmil6800" path="res://Resources/card_ability.gd" id="2_cm1c1"]
[ext_resource type="Script" uid="uid://c4u8pww3jsm12" path="res://Resources/deck_definition.gd" id="2_w7xgs"]
[ext_resource type="Script" uid="uid://bdwr18g3ouvfo" path="res://Resources/god_card_collection.gd" id="3_cm1c1"]
[ext_resource type="Script" uid="uid://bqbrhjegh1g6e" path="res://Resources/Abilities/stat_boost_ability.gd" id="3_dwe15"]
[ext_resource type="Script" uid="uid://b72irnrav5w53" path="res://Resources/Abilities/defensive_counter_ability.gd" id="4_dwe15"]
[ext_resource type="Script" uid="uid://dgsvwgjhs2vju" path="res://Resources/Abilities/stat_nullify_ability.gd" id="4_ooqpa"]
[ext_resource type="Script" uid="uid://d1cwgpmvptcjn" path="res://Resources/Abilities/passive_boost_ability.gd" id="6_e1acv"]
[ext_resource type="Script" uid="uid://43v8bwokc47i" path="res://Resources/Abilities/extended_range_ability.gd" id="7_ej0q7"]

[sub_resource type="GDScript" id="GDScript_e1acv"]
script/source = "# res://Resources/card_resource.gd
class_name CardResource
extends Resource

# Inner class for level data (no class_name declaration)
class LevelData extends Resource:
	@export var level: int = 1
	@export var values: Array[int] = [1, 1, 1, 1]  # [Up, Right, Down, Left]
	@export var abilities: Array[CardAbility] = []
	@export_multiline var description: String = \"\"  # Level-specific description if needed

# Main CardResource fields
@export var card_name: String
@export var card_texture: Texture2D

# Legacy fields (for backward compatibility)
@export var values: Array[int] = [1, 1, 1, 1]  # [Up, Right, Down, Left]
@export_multiline var description: String = \"\"
@export var abilities: Array[CardAbility] = []

# NEW: Level progression data
@export var level_data: Array[LevelData] = []
@export var uses_level_progression: bool = false

# Get data for specific level
func get_level_data(level: int) -> LevelData:
	if not uses_level_progression or level_data.is_empty():
		# Fallback to legacy data
		var fallback = LevelData.new()
		fallback.level = level
		fallback.values = values.duplicate()
		fallback.abilities = abilities.duplicate()
		fallback.description = description
		return fallback
	
	# Find exact level match
	for data in level_data:
		if data.level == level:
			return data
	
	# If no exact match, return highest available level <= requested level
	var best_match: LevelData = null
	for data in level_data:
		if data.level <= level:
			if not best_match or data.level > best_match.level:
				best_match = data
	
	return best_match if best_match else level_data[0]

# Convenience methods
func get_effective_values(level: int) -> Array[int]:
	return get_level_data(level).values.duplicate()

func get_effective_abilities(level: int) -> Array[CardAbility]:
	return get_level_data(level).abilities.duplicate()

func get_effective_description(level: int) -> String:
	var level_desc = get_level_data(level).description
	return level_desc if level_desc != \"\" else description

# Check if card has abilities of a specific type at a given level
func has_ability_type(trigger_type: CardAbility.TriggerType, level: int) -> bool:
	var abilities = get_effective_abilities(level)
	for ability in abilities:
		if ability and ability.trigger_condition == trigger_type:
			return true
	return false

# Get all available abilities for a specific level  
func get_available_abilities(level: int) -> Array[CardAbility]:
	return get_effective_abilities(level)

# Execute abilities of a specific type
func execute_abilities(trigger_type: CardAbility.TriggerType, context: Dictionary, level: int):
	var abilities = get_effective_abilities(level)
	for ability in abilities:
		if ability and ability.trigger_condition == trigger_type:
			if ability.can_execute(context):
				ability.execute(context)
				print(\"Executed ability: \", ability.ability_name)
"

[sub_resource type="Resource" id="Resource_sfw3d"]
script = ExtResource("3_dwe15")
boost_amount = 1
ability_name = "Stat Boost"
description = "When attacking, increase your power value by 1"
unlock_level = 0
trigger_condition = 0
metadata/_custom_type_script = "uid://bqbrhjegh1g6e"

[sub_resource type="GDScript" id="GDScript_ej0q7"]

[sub_resource type="Resource" id="Resource_vqrrp"]
script = SubResource("GDScript_e1acv")
card_name = "Helios"
values = Array[int]([5, 5, 5, 5])
description = "The sun titan arrives"
abilities = Array[ExtResource("2_cm1c1")]([SubResource("Resource_sfw3d")])
level_data = Array[SubResource("GDScript_ej0q7")]([null, null, null])
uses_level_progression = true
metadata/_custom_type_script = "uid://lhqcxql28o5c"

[sub_resource type="Resource" id="Resource_bj61k"]
script = ExtResource("4_ooqpa")
ability_name = "Stat Nullify"
description = "When this card is captured its stats are reduced to 1."
unlock_level = 0
trigger_condition = 2
metadata/_custom_type_script = "uid://dgsvwgjhs2vju"

[sub_resource type="Resource" id="Resource_w7xgs"]
script = SubResource("GDScript_e1acv")
card_name = "Cygnus"
values = Array[int]([2, 2, 2, 2])
description = "Oh Phaeton, don't listen to him!"
abilities = Array[ExtResource("2_cm1c1")]([SubResource("Resource_bj61k")])
level_data = Array[SubResource("GDScript_ej0q7")]([])
uses_level_progression = false
metadata/_custom_type_script = "uid://lhqcxql28o5c"

[sub_resource type="Resource" id="Resource_l7o3e"]
script = ExtResource("4_dwe15")
ability_name = "Defensive Counter"
description = "When this card successfully defends against an enemy attack, capture the attacking card"
unlock_level = 0
trigger_condition = 1
metadata/_custom_type_script = "uid://b72irnrav5w53"

[sub_resource type="Resource" id="Resource_cm1c1"]
script = SubResource("GDScript_e1acv")
card_name = "Phaeton"
values = Array[int]([3, 9, 8, 1])
description = "You just cant give Epiphus the satisfaction"
abilities = Array[ExtResource("2_cm1c1")]([SubResource("Resource_l7o3e")])
level_data = Array[SubResource("GDScript_ej0q7")]([])
uses_level_progression = false
metadata/_custom_type_script = "uid://lhqcxql28o5c"

[sub_resource type="Resource" id="Resource_f31oe"]
script = ExtResource("6_e1acv")
boost_amount = 1
ability_name = "Divine Inspiration"
description = "While under your control, all other friendly cards gain +1 to all stats"
unlock_level = 0
trigger_condition = 3
metadata/_custom_type_script = "uid://d1cwgpmvptcjn"

[sub_resource type="Resource" id="Resource_dwe15"]
script = SubResource("GDScript_e1acv")
card_name = "Eos, the dawn"
values = Array[int]([2, 2, 2, 2])
description = "Welcome to a new day"
abilities = Array[ExtResource("2_cm1c1")]([SubResource("Resource_f31oe")])
level_data = Array[SubResource("GDScript_ej0q7")]([])
uses_level_progression = false
metadata/_custom_type_script = "uid://lhqcxql28o5c"

[sub_resource type="Resource" id="Resource_lg4ks"]
script = ExtResource("7_ej0q7")
ability_name = "Extended Range"
description = "This card attacks also attacks diagonal directions"
unlock_level = 0
trigger_condition = 0
metadata/_custom_type_script = "uid://43v8bwokc47i"

[sub_resource type="Resource" id="Resource_ooqpa"]
script = SubResource("GDScript_e1acv")
card_name = "Phelgon"
values = Array[int]([8, 8, 2, 2])
description = "Look at my horse"
abilities = Array[ExtResource("2_cm1c1")]([SubResource("Resource_lg4ks")])
level_data = Array[SubResource("GDScript_ej0q7")]([])
uses_level_progression = false
metadata/_custom_type_script = "uid://lhqcxql28o5c"

[sub_resource type="Resource" id="Resource_e1acv"]
script = SubResource("GDScript_e1acv")
card_name = "The Lyre"
values = Array[int]([5, 5, 5, 5])
description = "Heavenly music "
abilities = Array[ExtResource("2_cm1c1")]([])
level_data = Array[SubResource("GDScript_ej0q7")]([])
uses_level_progression = false
metadata/_custom_type_script = "uid://lhqcxql28o5c"

[sub_resource type="Resource" id="Resource_ej0q7"]
script = SubResource("GDScript_e1acv")
card_name = "Orpheus"
values = Array[int]([6, 7, 6, 7])
description = "The sweetest voice yet alive"
abilities = Array[ExtResource("2_cm1c1")]([])
level_data = Array[SubResource("GDScript_ej0q7")]([])
uses_level_progression = false
metadata/_custom_type_script = "uid://lhqcxql28o5c"

[sub_resource type="Resource" id="Resource_gowu1"]
script = SubResource("GDScript_e1acv")
card_name = "Marceius "
values = Array[int]([8, 2, 8, 2])
description = "Sometimes you think you got this, reality is often cruel"
abilities = Array[ExtResource("2_cm1c1")]([])
level_data = Array[SubResource("GDScript_ej0q7")]([])
uses_level_progression = false
metadata/_custom_type_script = "uid://lhqcxql28o5c"

[sub_resource type="Resource" id="Resource_p7jhq"]
script = SubResource("GDScript_e1acv")
card_name = "Euridyce"
values = Array[int]([6, 4, 4, 8])
description = "Love you would go all the way to hell for"
abilities = Array[ExtResource("2_cm1c1")]([])
level_data = Array[SubResource("GDScript_ej0q7")]([])
uses_level_progression = false
metadata/_custom_type_script = "uid://lhqcxql28o5c"

[sub_resource type="Resource" id="Resource_2h7tk"]
script = SubResource("GDScript_e1acv")
card_name = "Calliope"
values = Array[int]([7, 7, 8, 8])
description = "From when all lovely voices spring"
abilities = Array[ExtResource("2_cm1c1")]([])
level_data = Array[SubResource("GDScript_ej0q7")]([])
uses_level_progression = false
metadata/_custom_type_script = "uid://lhqcxql28o5c"

[sub_resource type="Resource" id="Resource_bufwg"]
script = SubResource("GDScript_e1acv")
card_name = "Delphic Oracle"
values = Array[int]([3, 3, 3, 3])
description = "The power and curse of knowing"
abilities = Array[ExtResource("2_cm1c1")]([])
level_data = Array[SubResource("GDScript_ej0q7")]([])
uses_level_progression = false
metadata/_custom_type_script = "uid://lhqcxql28o5c"

[sub_resource type="Resource" id="Resource_ca26u"]
script = SubResource("GDScript_e1acv")
card_name = "Cassandra"
values = Array[int]([5, 5, 5, 5])
description = "You wont listen"
abilities = Array[ExtResource("2_cm1c1")]([])
level_data = Array[SubResource("GDScript_ej0q7")]([])
uses_level_progression = false
metadata/_custom_type_script = "uid://lhqcxql28o5c"

[sub_resource type="Resource" id="Resource_qbbw0"]
script = SubResource("GDScript_e1acv")
card_name = "Tiresias"
values = Array[int]([4, 8, 8, 4])
description = "He may be blind but it is you who cannot see"
abilities = Array[ExtResource("2_cm1c1")]([])
level_data = Array[SubResource("GDScript_ej0q7")]([])
uses_level_progression = false
metadata/_custom_type_script = "uid://lhqcxql28o5c"

[sub_resource type="Resource" id="Resource_xjxyc"]
script = SubResource("GDScript_e1acv")
card_name = "Calchas"
values = Array[int]([2, 6, 8, 4])
description = "Let the man speak his mind, even if its not what you want to hear"
abilities = Array[ExtResource("2_cm1c1")]([])
level_data = Array[SubResource("GDScript_ej0q7")]([])
uses_level_progression = false
metadata/_custom_type_script = "uid://lhqcxql28o5c"

[sub_resource type="Resource" id="Resource_b0n1o"]
script = SubResource("GDScript_e1acv")
card_name = "The Fates"
values = Array[int]([8, 9, 8, 6])
description = "Lets no pretend you have any control over what they are doing"
abilities = Array[ExtResource("2_cm1c1")]([])
level_data = Array[SubResource("GDScript_ej0q7")]([])
uses_level_progression = false
metadata/_custom_type_script = "uid://lhqcxql28o5c"

[sub_resource type="Resource" id="Resource_tn03x"]
script = ExtResource("2_w7xgs")
deck_name = "The Sun"
deck_description = "Shining forth from the utmost heights of heaven"
card_indices = Array[int]([0, 1, 2, 3, 4])
is_starter_deck = true
required_capture_exp = 0
required_defense_exp = 0
deck_power_type = 1
power_config = {}
metadata/_custom_type_script = "uid://c4u8pww3jsm12"

[sub_resource type="Resource" id="Resource_cknfu"]
script = ExtResource("2_w7xgs")
deck_name = "Natural Harmonics"
deck_description = "Have faith in what music can do"
card_indices = Array[int]([5, 6, 7, 8, 9])
is_starter_deck = false
required_capture_exp = 100
required_defense_exp = 0
deck_power_type = 0
power_config = {}
metadata/_custom_type_script = "uid://c4u8pww3jsm12"

[sub_resource type="Resource" id="Resource_tpnlu"]
script = ExtResource("2_w7xgs")
deck_name = "Phoebus Apollo"
deck_description = "The master of augury guides your moves"
card_indices = Array[int]([10, 11, 12, 13, 14])
is_starter_deck = false
required_capture_exp = 0
required_defense_exp = 100
deck_power_type = 2
power_config = {}
metadata/_custom_type_script = "uid://c4u8pww3jsm12"

[resource]
script = ExtResource("3_cm1c1")
god_name = "Apollo"
cards = Array[SubResource("GDScript_e1acv")]([SubResource("Resource_vqrrp"), SubResource("Resource_w7xgs"), SubResource("Resource_cm1c1"), SubResource("Resource_dwe15"), SubResource("Resource_ooqpa"), SubResource("Resource_e1acv"), SubResource("Resource_ej0q7"), SubResource("Resource_gowu1"), SubResource("Resource_p7jhq"), SubResource("Resource_2h7tk"), SubResource("Resource_bufwg"), SubResource("Resource_ca26u"), SubResource("Resource_qbbw0"), SubResource("Resource_xjxyc"), SubResource("Resource_b0n1o")])
decks = Array[ExtResource("2_w7xgs")]([SubResource("Resource_tn03x"), SubResource("Resource_cknfu"), SubResource("Resource_tpnlu")])
metadata/_custom_type_script = "uid://bdwr18g3ouvfo"
